<link rel="stylesheet" type="text/css" href="./styles.css" />
<link rel="stylesheet" type="text/css" href="./toggle-style.css" />

<div id="parede" class="container">
  <img 
    id="apagada" 
    src="./off.png" 
    alt="imagem apagada" 
    class="imagem"
  >
  <img 
    id="acesa" 
    src="./on.png" 
    alt="imagem acesa" 
    class="imagem"
  >

  <div id="fio-conector">
    <div id="fio-energia">
    </div>
  </div>

  <div class="toggle-wrapper">
    <div class="toggle normal">
      <input id="normal" type="checkbox">
      <label class="toggle-item" for="normal"></label>
    </div>
  </div>
</div>
<script>
  const parede = document.getElementById('parede')
  const apagada = document.getElementById('apagada')
  const acesa = document.getElementById('acesa')
  const fioEnergia = document.getElementById('fio-energia')
  const input = document.getElementById('normal')

  const totalTimeMs = 2000

  function ligarEnergia(shouldTurnOn) {
    let start = null
    
    let alturaInicial = parseFloat(fioEnergia.style.height) || 0
    let alturaFinal = shouldTurnOn ? 100 : 0
    
    let diferenca = alturaFinal - alturaInicial

    function passo(timestamp) {
      if (!start) {
        start = timestamp
      }

      const elapsed = timestamp - start
      const progress = Math.min(elapsed / totalTimeMs, 1)

      const alturaAtual = alturaInicial + (diferenca * progress)
      fioEnergia.style.height = alturaAtual + '%'
      const hasAchievedProgress = progress === 1

      if (!hasAchievedProgress) {
        requestAnimationFrame(passo)
      }

      if(hasAchievedProgress && shouldTurnOn) {
        toggleLightBulb({
          on:  'initial',
          off: 'none',
          wall: 'var(--cor-defundo-ativa)',
        })
      }

      if(!shouldTurnOn) {
        toggleLightBulb({
          on:  'none',
          off: 'initial',
          wall: 'var(--cor-defundo)',
        })
      }
    }

    requestAnimationFrame(passo)
  }

 
  function toggleLightBulb({ on, off, wall }) {
    apagada.style.display = off
    acesa.style.display = on
    parede.style.background = wall
  }

  input.addEventListener('change', (event) => {
    const shouldTurnOn = !!event.target.checked
    ligarEnergia(shouldTurnOn)
  })

  fioEnergia.style.height = '0%'
  acesa.style.display = 'none'
</script>
